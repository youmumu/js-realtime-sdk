<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Home - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AudioMessage.html">AudioMessage</a><ul class='methods'><li data-type='method'><a href="AudioMessage.html#getAttributes">getAttributes</a></li><li data-type='method'><a href="AudioMessage.html#getFile">getFile</a></li><li data-type='method'><a href="AudioMessage.html#getText">getText</a></li><li data-type='method'><a href="AudioMessage.html#setAttributes">setAttributes</a></li><li data-type='method'><a href="AudioMessage.html#setNeedReceipt">setNeedReceipt</a></li><li data-type='method'><a href="AudioMessage.html#setText">setText</a></li><li data-type='method'><a href="AudioMessage.html#setTransient">setTransient</a></li><li data-type='method'><a href="AudioMessage.html#toJSON">toJSON</a></li></ul></li><li><a href="Conversation.html">Conversation</a><ul class='methods'><li data-type='method'><a href="Conversation.html#add">add</a></li><li data-type='method'><a href="Conversation.html#count">count</a></li><li data-type='method'><a href="Conversation.html#createMessagesIterator">createMessagesIterator</a></li><li data-type='method'><a href="Conversation.html#fetch">fetch</a></li><li data-type='method'><a href="Conversation.html#join">join</a></li><li data-type='method'><a href="Conversation.html#markAsRead">markAsRead</a></li><li data-type='method'><a href="Conversation.html#mute">mute</a></li><li data-type='method'><a href="Conversation.html#queryMessages">queryMessages</a></li><li data-type='method'><a href="Conversation.html#quit">quit</a></li><li data-type='method'><a href="Conversation.html#remove">remove</a></li><li data-type='method'><a href="Conversation.html#save">save</a></li><li data-type='method'><a href="Conversation.html#send">send</a></li><li data-type='method'><a href="Conversation.html#setAttribute">setAttribute</a></li><li data-type='method'><a href="Conversation.html#setAttributes">setAttributes</a></li><li data-type='method'><a href="Conversation.html#setName">setName</a></li><li data-type='method'><a href="Conversation.html#unmute">unmute</a></li></ul></li><li><a href="ConversationQuery.html">ConversationQuery</a><ul class='methods'><li data-type='method'><a href="ConversationQuery.html#addAscending">addAscending</a></li><li data-type='method'><a href="ConversationQuery.html#addDescending">addDescending</a></li><li data-type='method'><a href="ConversationQuery.html#ascending">ascending</a></li><li data-type='method'><a href="ConversationQuery.html#compact">compact</a></li><li data-type='method'><a href="ConversationQuery.html#containedIn">containedIn</a></li><li data-type='method'><a href="ConversationQuery.html#contains">contains</a></li><li data-type='method'><a href="ConversationQuery.html#containsAll">containsAll</a></li><li data-type='method'><a href="ConversationQuery.html#containsMembers">containsMembers</a></li><li data-type='method'><a href="ConversationQuery.html#descending">descending</a></li><li data-type='method'><a href="ConversationQuery.html#endsWith">endsWith</a></li><li data-type='method'><a href="ConversationQuery.html#equalTo">equalTo</a></li><li data-type='method'><a href="ConversationQuery.html#find">find</a></li><li data-type='method'><a href="ConversationQuery.html#greaterThan">greaterThan</a></li><li data-type='method'><a href="ConversationQuery.html#greaterThanOrEqualTo">greaterThanOrEqualTo</a></li><li data-type='method'><a href="ConversationQuery.html#lessThan">lessThan</a></li><li data-type='method'><a href="ConversationQuery.html#lessThanOrEqualTo">lessThanOrEqualTo</a></li><li data-type='method'><a href="ConversationQuery.html#limit">limit</a></li><li data-type='method'><a href="ConversationQuery.html#matches">matches</a></li><li data-type='method'><a href="ConversationQuery.html#notContainsIn">notContainsIn</a></li><li data-type='method'><a href="ConversationQuery.html#notEqualTo">notEqualTo</a></li><li data-type='method'><a href="ConversationQuery.html#sizeEqualTo">sizeEqualTo</a></li><li data-type='method'><a href="ConversationQuery.html#skip">skip</a></li><li data-type='method'><a href="ConversationQuery.html#startsWith">startsWith</a></li><li data-type='method'><a href="ConversationQuery.html#withLastMessages">withLastMessages</a></li><li data-type='method'><a href="ConversationQuery.html#withLastMessagesRefreshed">withLastMessagesRefreshed</a></li><li data-type='method'><a href="ConversationQuery.html#withMembers">withMembers</a></li></ul></li><li><a href="FileMessage.html">FileMessage</a><ul class='methods'><li data-type='method'><a href="FileMessage.html#getAttributes">getAttributes</a></li><li data-type='method'><a href="FileMessage.html#getFile">getFile</a></li><li data-type='method'><a href="FileMessage.html#getText">getText</a></li><li data-type='method'><a href="FileMessage.html#setAttributes">setAttributes</a></li><li data-type='method'><a href="FileMessage.html#setNeedReceipt">setNeedReceipt</a></li><li data-type='method'><a href="FileMessage.html#setText">setText</a></li><li data-type='method'><a href="FileMessage.html#setTransient">setTransient</a></li><li data-type='method'><a href="FileMessage.html#toJSON">toJSON</a></li></ul></li><li><a href="ImageMessage.html">ImageMessage</a><ul class='methods'><li data-type='method'><a href="ImageMessage.html#getAttributes">getAttributes</a></li><li data-type='method'><a href="ImageMessage.html#getFile">getFile</a></li><li data-type='method'><a href="ImageMessage.html#getText">getText</a></li><li data-type='method'><a href="ImageMessage.html#setAttributes">setAttributes</a></li><li data-type='method'><a href="ImageMessage.html#setNeedReceipt">setNeedReceipt</a></li><li data-type='method'><a href="ImageMessage.html#setText">setText</a></li><li data-type='method'><a href="ImageMessage.html#setTransient">setTransient</a></li><li data-type='method'><a href="ImageMessage.html#toJSON">toJSON</a></li></ul></li><li><a href="IMClient.html">IMClient</a><ul class='methods'><li data-type='method'><a href="IMClient.html#close">close</a></li><li data-type='method'><a href="IMClient.html#createConversation">createConversation</a></li><li data-type='method'><a href="IMClient.html#getConversation">getConversation</a></li><li data-type='method'><a href="IMClient.html#getQuery">getQuery</a></li><li data-type='method'><a href="IMClient.html#markAllAsRead">markAllAsRead</a></li><li data-type='method'><a href="IMClient.html#ping">ping</a></li></ul></li><li><a href="LocationMessage.html">LocationMessage</a><ul class='methods'><li data-type='method'><a href="LocationMessage.html#getAttributes">getAttributes</a></li><li data-type='method'><a href="LocationMessage.html#getLocation">getLocation</a></li><li data-type='method'><a href="LocationMessage.html#getText">getText</a></li><li data-type='method'><a href="LocationMessage.html#setAttributes">setAttributes</a></li><li data-type='method'><a href="LocationMessage.html#setNeedReceipt">setNeedReceipt</a></li><li data-type='method'><a href="LocationMessage.html#setText">setText</a></li><li data-type='method'><a href="LocationMessage.html#setTransient">setTransient</a></li><li data-type='method'><a href="LocationMessage.html#toJSON">toJSON</a></li></ul></li><li><a href="Message.html">Message</a><ul class='methods'><li data-type='method'><a href="Message.html#.parse">parse</a></li><li data-type='method'><a href="Message.html#.validate">validate</a></li><li data-type='method'><a href="Message.html#setNeedReceipt">setNeedReceipt</a></li><li data-type='method'><a href="Message.html#setTransient">setTransient</a></li><li data-type='method'><a href="Message.html#toJSON">toJSON</a></li></ul></li><li><a href="Realtime.html">Realtime</a><ul class='methods'><li data-type='method'><a href="Realtime.html#createIMClient">createIMClient</a></li><li data-type='method'><a href="Realtime.html#register">register</a></li><li data-type='method'><a href="Realtime.html#retry">retry</a></li></ul></li><li><a href="TextMessage.html">TextMessage</a><ul class='methods'><li data-type='method'><a href="TextMessage.html#getAttributes">getAttributes</a></li><li data-type='method'><a href="TextMessage.html#getText">getText</a></li><li data-type='method'><a href="TextMessage.html#setAttributes">setAttributes</a></li><li data-type='method'><a href="TextMessage.html#setNeedReceipt">setNeedReceipt</a></li><li data-type='method'><a href="TextMessage.html#setText">setText</a></li><li data-type='method'><a href="TextMessage.html#setTransient">setTransient</a></li><li data-type='method'><a href="TextMessage.html#toJSON">toJSON</a></li></ul></li><li><a href="TypedMessage.html">TypedMessage</a><ul class='methods'><li data-type='method'><a href="TypedMessage.html#.parse">parse</a></li><li data-type='method'><a href="TypedMessage.html#getAttributes">getAttributes</a></li><li data-type='method'><a href="TypedMessage.html#getText">getText</a></li><li data-type='method'><a href="TypedMessage.html#setAttributes">setAttributes</a></li><li data-type='method'><a href="TypedMessage.html#setNeedReceipt">setNeedReceipt</a></li><li data-type='method'><a href="TypedMessage.html#setText">setText</a></li><li data-type='method'><a href="TypedMessage.html#setTransient">setTransient</a></li><li data-type='method'><a href="TypedMessage.html#toJSON">toJSON</a></li></ul></li><li><a href="VideoMessage.html">VideoMessage</a><ul class='methods'><li data-type='method'><a href="VideoMessage.html#getAttributes">getAttributes</a></li><li data-type='method'><a href="VideoMessage.html#getFile">getFile</a></li><li data-type='method'><a href="VideoMessage.html#getText">getText</a></li><li data-type='method'><a href="VideoMessage.html#setAttributes">setAttributes</a></li><li data-type='method'><a href="VideoMessage.html#setNeedReceipt">setNeedReceipt</a></li><li data-type='method'><a href="VideoMessage.html#setText">setText</a></li><li data-type='method'><a href="VideoMessage.html#setTransient">setTransient</a></li><li data-type='method'><a href="VideoMessage.html#toJSON">toJSON</a></li></ul></li></ul><h3>Events</h3><ul><li><a href="Conversation.html#event:invited">invited</a></li><li><a href="Conversation.html#event:kicked">kicked</a></li><li><a href="Conversation.html#event:memberjoined">memberjoined</a></li><li><a href="Conversation.html#event:memberleft">memberleft</a></li><li><a href="Conversation.html#event:message">message</a></li><li><a href="IMClient.html#event:close">close</a></li><li><a href="IMClient.html#event:conflict">conflict</a></li><li><a href="IMClient.html#event:invited">invited</a></li><li><a href="IMClient.html#event:kicked">kicked</a></li><li><a href="IMClient.html#event:memberjoined">memberjoined</a></li><li><a href="IMClient.html#event:memberleft">memberleft</a></li><li><a href="IMClient.html#event:message">message</a></li><li><a href="IMClient.html#event:unreadmessages">unreadmessages</a></li><li><a href="Realtime.html#event:disconnect">disconnect</a></li><li><a href="Realtime.html#event:reconnect">reconnect</a></li><li><a href="Realtime.html#event:retry">retry</a></li></ul><h3>Namespaces</h3><ul><li><a href="MessageHelper.html">MessageHelper</a><ul class='methods'><li data-type='method'><a href="MessageHelper.html#.exports.messageField">exports.messageField</a></li><li data-type='method'><a href="MessageHelper.html#.exports.messageType">exports.messageType</a></li></ul></li></ul><h3>Interfaces</h3><ul><li><a href="AVMessage.html">AVMessage</a><ul class='methods'><li data-type='method'><a href="AVMessage.html#.parse">parse</a></li><li data-type='method'><a href="AVMessage.html#.validate">validate</a></li><li data-type='method'><a href="AVMessage.html#toJSON">toJSON</a></li></ul></li></ul>
</nav>

<div id="main">
    

    



    









    


    <section class="readme">
        <article><h1>LeanCloud JavaScript Realtime SDK</h1><p><a href="https://travis-ci.org/leancloud/js-realtime-sdk/branches"><img src="https://img.shields.io/travis/leancloud/js-realtime-sdk/next.svg?style=flat-square" alt="Build Status"></a>
<a href="https://codecov.io/github/leancloud/js-realtime-sdk?branch=next"><img src="https://img.shields.io/codecov/c/github/leancloud/js-realtime-sdk/next.svg?style=flat-square" alt="Codecov"></a>
<a href="https://david-dm.org/leancloud/js-realtime-sdk"><img src="https://img.shields.io/david/leancloud/js-realtime-sdk.svg?style=flat-square" alt="David"></a>
<a href="https://www.npmjs.com/package/leancloud-realtime"><img src="https://img.shields.io/npm/v/leancloud-realtime.svg?style=flat-square" alt="npm"></a></p>
<p>为您的 JavaScript App 接入 LeanCloud 实时通讯服务。</p>
<h2>版本说明</h2><p>next 分支上为 3.x 版本。
master 分支上为 2.x 版本，将仅得到安全更新，相关文档参见 <a href="https://leancloud.cn/docs/js_realtime.html">2.x 文档</a>。</p>
<p>3.x 与 2.x 的 API 不兼容，以下说明与文档均指 3.x 版本。</p>
<p>试用 3.x beta 版本：</p>
<pre class="prettyprint source"><code>npm install leancloud-realtime@next</code></pre><h2>支持的运行环境</h2><ul>
<li>浏览器 / WebView<ul>
<li>IE 10+ / Edge</li>
<li>Chrome 31+</li>
<li>Firefox latest</li>
<li>iOS 8.0+</li>
<li>Android 4.4+</li>
</ul>
</li>
<li>Node.js 0.12+</li>
<li>React Native<ul>
<li>iOS 0.22+</li>
<li>Android 0.25+</li>
</ul>
</li>
</ul>
<p>其中在 React Native 中运行需要在初始化 <a href="https://leancloud.github.io/js-realtime-sdk/docs/Realtime.html#Realtime">Realtime</a> 时设置 <code>options.noBinary</code> 为 <code>true</code>。</p>
<h2>文档</h2><ul>
<li><a href="https://leancloud.cn/docs/realtime_guide-js.html#安装和初始化">安装文档</a></li>
<li><a href="https://leancloud.cn/docs/realtime_guide-js.html">使用文档</a></li>
<li><a href="https://leancloud.github.io/js-realtime-sdk/docs/">API 文档</a></li>
</ul>
<h2>支持</h2><ul>
<li>如果你发现了新的 bug，或者有新的 feature request，请新建一个 issue</li>
<li>在使用过程中遇到了问题时<ul>
<li>如果你购买了技术支持服务，请新建一个 ticket。</li>
<li>也可以在 <a href="https://forum.leancloud.cn/">论坛</a> 提问、讨论。</li>
</ul>
</li>
</ul>
<h2>贡献</h2><p>如果你希望为这个项目贡献代码，请按以下步骤进行：</p>
<ol>
<li>Fork 这个项目，clone 到本地</li>
<li>在目录中执行 <code>npm install</code> 安装所需 Node.js 依赖包</li>
<li>在目录中执行 <code>bower install</code> 安装所需 web 依赖包</li>
<li>执行 <code>grunt dev</code> 浏览器打开 <a href="http://localhost:8000"></a> 本地进行调试</li>
<li>编码，更新测试用例</li>
<li>运行 <code>npm test</code> 确保测试全部 pass</li>
<li>提交改动，请遵循 <a href="http://www.ruanyifeng.com/blog/2016/01/commit_message_change_log.html">conversational commit message 风格</a></li>
<li>发起 Pull Request 至 <strong>next 分支</strong></li>
</ol>
<h3>项目的目录结构</h3><pre class="prettyprint source"><code>.
├── demo
├── deploy.sh               // 部署 gh-pages 分支
├── dist                    // 打包产出
│   ├── realtime.browser.js     // 浏览器用
│   ├── realtime.browser.min.js // 浏览器用(uglified)
│   └── realtime.js             // node 用
├── proto
│   ├── message-compiled.js     // 使用 pbjs 生成的 message 类
│   ├── message.js              // ES6 wrapper
│   └── message.proto           // proto 原始文件
├── release.sh                // 部署 dist 分支
├── src                       // 源码
│   └── index.js                // 打包入口
├── test                      // 测试用例
│   ├── browser                 // 浏览器测试入口
│   └── index.js                // 测试入口
└── typed-messages            // leancloud-realtime-typed-messages package</code></pre><h3>Architecture</h3><p>SDK 分为连接层与应用层两部分，只存在应用层对连接层公开 API 的调用，连接层对开发者不可见。</p>
<h4>连接层</h4><ul>
<li><code>WebSocketPlus</code>：封装了 WebSocket。相比 w3 WebSocket，增加了以下特性：<ul>
<li>是一个有限状态机</li>
<li>实现了 <a href="https://nodejs.org/api/events.html">Node.js EventEmitter 接口</a></li>
<li>超时与自动重连机制</li>
<li>url 参数支持 Promise 及备用地址</li>
</ul>
</li>
<li><code>Connection</code>：继承自 <code>WebSocketPlus</code>，增加了与业务相关的功能：<ul>
<li>根据 subprotocol 自动处理发送与接收的消息，应用层发送接收的均是 ProtoBuf Message 类</li>
<li><code>send</code> 接口返回 Promise，在 server 回复后才算 send 成功</li>
<li>实现了应用层 ping/pong</li>
</ul>
</li>
</ul>
<h4>应用层</h4><ul>
<li><code>Realtime</code>：开发者使用 SDK 的入口，负责访问 router、创建 connection、创建与管理 clients、创建 messageParser（管理消息类型）、监听 connection 的消息并 dispatch 给对应的 client</li>
<li><code>Client</code>：所有的 clients 共享一个 connection<ul>
<li><code>IMClient</code>：对应即时通讯中的「用户」，持有 connection 与 conversations，负责创建管理将收到的消息处理后在对应 conversation 上派发，所有的 IMClients 共享一个 messageParser</li>
<li><code>PushClient</code>：not implemented yet</li>
</ul>
</li>
<li><code>MessageParser</code> 消息解析器，负责将一个 JSON 格式的消息 parse 为对应的 Message 类</li>
<li><code>Conversation</code>：实现对话相关的操作<ul>
<li><code>ConversationQuery</code>：对话查询器</li>
</ul>
</li>
<li><code>Messages</code><ul>
<li><code>AVMessage</code>：接口描述，生成文档用</li>
<li><code>Message</code>：消息基类</li>
<li><code>TypedMessage</code>：类型消息基类，继承自 <code>Message</code></li>
<li><code>TextMessage</code>：文本消息，继承自 <code>TypedMessage</code></li>
<li>其他富媒体消息类（<code>FileMessage</code> 及其子类、<code>LocationMessage</code>）由于依赖 leancloud-storage，作为另一个独立 package 发布</li>
</ul>
</li>
</ul>
<h3>开启调试模式</h3><h4>Node.js</h4><pre class="prettyprint source lang-bash"><code>export DEBUG=LC*</code></pre><h4>浏览器</h4><pre class="prettyprint source lang-javascript"><code>localStorage.setItem('debug', 'LC*');</code></pre><h2>Develop Workflow</h2><h3>本地开发</h3><p>更新 .proto 后请运行</p>
<pre class="prettyprint source"><code>npm run convert-pb</code></pre><p>测试</p>
<pre class="prettyprint source"><code>npm run test:node -- --grep KEYWORDS</code></pre><p>浏览器测试</p>
<pre class="prettyprint source"><code># 在当前目录启动一个静态 server
# static . -p 8000
npm run test:browser
# open http://localhost:8000/test/browser/</code></pre><p>生成 dist/realtime.*</p>
<pre class="prettyprint source"><code>npm run build</code></pre><h3>持续集成</h3><p>合并 PR 到 next 分支后持续集成会自动运行 <code>npm build</code> 与 <code>npm run doc</code>，然后将 dist 目录推送到 dist 分支，将文档与 demo 推送到 gh-pages。</p>
<h2>Release Process Workflow</h2><ol>
<li>遵循 semver 提升 <code>package.json</code> 与 <code>bower.json</code> 中的版本号</li>
<li><code>npm run changelog</code> 生成新的 <code>changelog.md</code>，润色之</li>
<li>Commit <code>package.json</code>，<code>bower.json</code>，<code>changelog.md</code></li>
<li>Push to remote <code>next</code> branch</li>
<li>等待持续集成 pass</li>
<li>使用 GitHub 基于 dist 分支生成 pre-release 包（for bower）</li>
<li>Fetch and checkout remote <code>dist</code> branch 并确认该提交的内容是即将发布的版本</li>
<li>npm publish with <code>next</code> tag（<code>npm publish --tag=next</code>，需 npm 协作者身份）</li>
<li><code>grunt upload</code> 上传到 CDN</li>
<li>发布 leancloud-realtime-typed-messages（<code>cd typed-messages &amp;&amp; npm publish</code>）</li>
</ol></article>
    </section>






</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Wed Jun 08 2016 06:39:01 GMT+0000 (UTC) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>